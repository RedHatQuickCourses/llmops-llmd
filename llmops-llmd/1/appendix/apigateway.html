<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>OpenShift Gateway API for AI Deployments :: vLLM to AI Factory Scaling with LLM-D</title>
    <meta name="generator" content="Antora 3.1.3">
    <link rel="stylesheet" href="../../../_/css/site.css">
    <script>var uiRootPath = '../../../_'</script>
  </head>
  <body class="article">
<header class="header">
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://www.redhat.com" target="_blank"><img src="../../../_/img/redhat-logo.png" height="40px" alt="Red Hat"></a>
      <a class="navbar-item" style="font-size: 24px; color: white" href="../../..">vLLM to AI Factory Scaling with LLM-D</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <a class="navbar-item" href="https://github.com/RedHatQuickCourses/REPLACEREPONAME/issues" target="_blank">Report Issues</a>
      </div>
    </div>
  </nav>
</header>
<div class="body">
<div class="nav-container" data-component="llmops-llmd" data-version="1">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="../index.html">vLLM to AI Factory Scaling with LLM-D</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../chapter3/section1.html">LLM-D Benefits</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../chapter3/section2.html">Use Case Identification</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../chapter3/section4.html">Distributed Inference with llm-d OpenShift AI Architecture</a>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="../chapter3/section6.html">Lab Demo: llm-d Deployment Guide Arcade Experience</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="appendix.html">Appendix</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="index.html">Taxonomy to Know</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="kvcache.html">Deep Dive on KV Cache Management</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="lws.html">LeaderWorkerSet (LWS) Operator</a>
  </li>
</ul>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">vLLM to AI Factory Scaling with LLM-D</span>
    <span class="version">1</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <a class="title" href="../index.html">vLLM to AI Factory Scaling with LLM-D</a>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="../index.html">1</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="../index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="../index.html">vLLM to AI Factory Scaling with LLM-D</a></li>
    <li><a href="apigateway.html">OpenShift Gateway API for AI Deployments</a></li>
  </ul>
</nav>
</div>
  <div class="content">
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
<article class="doc">
<h1 class="page">OpenShift Gateway API for AI Deployments</h1>
<div class="sect1">
<h2 id="_overview"><a class="anchor" href="#_overview"></a>Overview</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This guide provides the procedures for setting up and configuring the Kubernetes Gateway API on OpenShift Container Platform. The Gateway API is a prerequisite for many advanced routing features used by OpenShift AI, including the llm-d smart scheduler.</p>
</div>
<div class="paragraph">
<p>The Gateway API is an open-source, community-managed networking mechanism that extends the Ingress Operator to handle more granular cluster traffic and routing configurations.</p>
</div>
<div class="sect2">
<h3 id="_1_benefits_of_gateway_api"><a class="anchor" href="#_1_benefits_of_gateway_api"></a>1. Benefits of Gateway API</h3>
<div class="paragraph">
<p>The Gateway API provides several key benefits:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Portability: It does not rely on vendor-specific annotations.</p>
</li>
<li>
<p>Separation of Concerns: It uses a role-based approach. Platform engineers can manage the GatewayClass, cluster admins can manage Gateway resources, and application developers can focus on HTTPRoute resources.</p>
</li>
<li>
<p>Extensibility: New functionality is added as standardized CRDs.</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="_2_limitations_of_gateway_api"><a class="anchor" href="#_2_limitations_of_gateway_api"></a>2. Limitations of Gateway API</h3>
<div class="paragraph">
<p>Be aware of the following limitations:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Version Incompatibilities: The Gateway API ecosystem changes rapidly. You must use the versions supported and managed by the OpenShift Ingress Operator.</p>
</li>
<li>
<p>Resource Overhead: Gateway API uses multiple resource types. For very simple applications, traditional Ingress might be a better fit.</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
Gateway API does not support user-defined networks (UDN).
</td>
</tr>
</table>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_2_getting_started_procedure_for_ingress_operator"><a class="anchor" href="#_2_getting_started_procedure_for_ingress_operator"></a>2. Getting Started: Procedure for Ingress Operator</h2>
<div class="sectionbody">
<div class="paragraph">
<p>When you create a GatewayClass as shown in the first step, it configures Gateway API for use on your cluster.</p>
</div>
<div class="sect2">
<h3 id="_step_1_create_a_gatewayclass_object"><a class="anchor" href="#_step_1_create_a_gatewayclass_object"></a>Step 1. Create a GatewayClass Object</h3>
<div class="paragraph">
<p>First, you must create a GatewayClass that points to the OpenShift-managed controller.</p>
</div>
<div class="paragraph">
<p>Create a YAML file named openshift-default.yaml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: gateway.networking.k8s.io/v1
kind: GatewayClass
metadata:
name: openshift-default
spec:
controllerName: openshift.io/gateway-controller/v1 <i class="conum" data-value="1"></i><b>(1)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p><strong>&lt;1&gt; The controller name must be exactly as shown. This is the only controller name the OpenShift Ingress Operator will manage.</strong></p>
</div>
<div class="paragraph">
<p>Run the following command to create the resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc create -f openshift-default.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">gatewayclass.gateway.networking.k8s.io/openshift-default created</code></pre>
</div>
</div>
<div class="paragraph">
<p>(Optional) Verify that the new deployment, istiod-openshift-gateway, is ready:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc get deployment -n openshift-ingress</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">NAME                       READY   UP-TO-DATE   AVAILABLE   AGE
istiod-openshift-gateway   1/1     1            1           55s
router-default             2/2     2            2           6h4m</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_2_create_a_tls_secret"><a class="anchor" href="#_step_2_create_a_tls_secret"></a>Step 2. Create a TLS Secret</h3>
<div class="paragraph">
<p>Create a secret containing your wildcard certificate and key.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc -n openshift-ingress create secret tls gwapi-wildcard</code></pre>
</div>
</div>
<div class="paragraph">
<p>--cert=wildcard.crt --key=wildcard.key</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_3_get_the_ingress_domain"><a class="anchor" href="#_step_3_get_the_ingress_domain"></a>Step 3. Get the Ingress Domain</h3>
<div class="paragraph">
<p>Get the domain of the Ingress Operator, which you will use in the Gateway object.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ DOMAIN=$(oc get ingresses.config/cluster -o jsonpath={.spec.domain})</code></pre>
</div>
</div>
<div class="paragraph">
<p>(This command saves your cluster&#8217;s domain to the $DOMAIN shell variable.)</p>
</div>
</div>
<div class="sect2">
<h3 id="_step_4_create_a_gateway_object"><a class="anchor" href="#_step_4_create_a_gateway_object"></a>Step 4. Create a Gateway Object</h3>
<div class="paragraph">
<p>Now, create the Gateway resource itself.</p>
</div>
<div class="paragraph">
<p>Create a YAML file named example-gateway.yaml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: gateway.networking.k8s.io/v1
kind: Gateway
metadata:
name: example-gateway
namespace: openshift-ingress <i class="conum" data-value="1"></i><b>(1)</b>
spec:
gatewayClassName: openshift-default <i class="conum" data-value="2"></i><b>(2)</b>
listeners:</code></pre>
</div>
</div>
<div class="paragraph">
<p>name: https &lt;3&gt;
hostname: "*.gwapi.${DOMAIN}" &lt;4&gt;
port: 443
protocol: HTTPS
tls:
mode: Terminate
certificateRefs:</p>
</div>
<div class="paragraph">
<p>name: gwapi-wildcard &lt;5&gt;
allowedRoutes:
namespaces:
from: All</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The Gateway object must be created in the openshift-ingress namespace.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This must reference the GatewayClass you created in Step 1.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>This listener listens for HTTPS requests.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>The hostname must be a subdomain of the Ingress Operator domain ($DOMAIN).</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>This must be the name of the secret you created in Step 2.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Apply the resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc apply -f example-gateway.yaml</code></pre>
</div>
</div>
</div>
<div class="sect2">
<h3 id="_step_5_create_an_httproute_resource"><a class="anchor" href="#_step_5_create_an_httproute_resource"></a>Step 5. Create an HTTPRoute Resource</h3>
<div class="paragraph">
<p>Finally, create an HTTPRoute to direct requests to your application (e.g., your AI model&#8217;s endpoint).</p>
</div>
<div class="paragraph">
<p>Assume you have an application named example-app in the example-app-ns namespace.</p>
</div>
<div class="paragraph">
<p>Create a YAML file named example-route.yaml:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-yaml hljs" data-lang="yaml">apiVersion: gateway.networking.k8s.io/v1
kind: HTTPRoute
metadata:
name: example-route
namespace: example-app-ns <i class="conum" data-value="1"></i><b>(1)</b>
spec:
parentRefs: <i class="conum" data-value="2"></i><b>(2)</b></code></pre>
</div>
</div>
<div class="paragraph">
<p>name: example-gateway
namespace: openshift-ingress
hostnames: ["example.gwapi.${DOMAIN}"] &lt;3&gt;
rules:</p>
</div>
<div class="paragraph">
<p>backendRefs: &lt;4&gt;</p>
</div>
<div class="paragraph">
<p>name: example-app &lt;5&gt;
port: 8443</p>
</div>
<div class="colist arabic">
<table>
<tr>
<td><i class="conum" data-value="1"></i><b>1</b></td>
<td>The namespace where your application is deployed.</td>
</tr>
<tr>
<td><i class="conum" data-value="2"></i><b>2</b></td>
<td>This field must point to the Gateway object you created in Step 4.</td>
</tr>
<tr>
<td><i class="conum" data-value="3"></i><b>3</b></td>
<td>The hostname must match one specified in the Gateway object.</td>
</tr>
<tr>
<td><i class="conum" data-value="4"></i><b>4</b></td>
<td>Specifies the backend references that point to your service.</td>
</tr>
<tr>
<td><i class="conum" data-value="5"></i><b>5</b></td>
<td>The name of the Service for your application.</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>Apply the resource:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc apply -f example-route.yaml</code></pre>
</div>
</div>
<div class="paragraph">
<p>Example Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">httproute.gateway.networking.k8s.io/example-route created</code></pre>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_3_verification"><a class="anchor" href="#_3_verification"></a>3. Verification</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Verify that the Gateway object is deployed and has the condition Programmed:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ oc wait -n openshift-ingress --for=condition=Programmed</code></pre>
</div>
</div>
<div class="paragraph">
<p>gateways.gateway.networking.k8s.io example-gateway</p>
</div>
<div class="paragraph">
<p>Example Output:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-text hljs" data-lang="text">gateway.gateway.networking.k8s.io/example-gateway condition met</code></pre>
</div>
</div>
<div class="paragraph">
<p>Send a request to the configured HTTPRoute object hostname:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">$ curl -I --cacert  https://example.gwapi.${DOMAIN}:443</code></pre>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_4_deployment_topologies"><a class="anchor" href="#_4_deployment_topologies"></a>4. Deployment Topologies</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The Gateway API is designed to accommodate two topologies:</p>
</div>
<div class="paragraph">
<p>Dedicated Gateway: (Default) Routes and load balancers are served from the same namespace. The Gateway object restricts routes to a particular application namespace.</p>
</div>
<div class="paragraph">
<p>Shared Gateway: Routes are served from multiple namespaces. The Gateway object uses the spec.listeners.allowedRoutes.namespaces field to filter which namespaces are allowed to attach routes.</p>
</div>
</div>
</div>
</article>
  </div>
</main>
</div>
<footer class="footer">
  <img src="../../../_/img/rhl-logo-red.png" height="40px" alt="Red Hat"  href="https://redhat.com" >
</footer><script id="site-script" src="../../../_/js/site.js" data-ui-root-path="../../../_"></script>
<script async src="../../../_/js/vendor/highlight.js"></script>
  </body>
</html>
